<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Content Permissions • connectapi</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Content Permissions">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">connectapi</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.5.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/connectapi_tags.html">connectapi Tags</a></li>
    <li><a class="dropdown-item" href="../articles/content_permissions.html">Content Permissions</a></li>
    <li><a class="dropdown-item" href="../articles/customize-http.html">Customize HTTP Requests</a></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started with connectapi</a></li>
    <li><a class="dropdown-item" href="../articles/lifecycle-statuses.html">Lifecycle Statuses</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/connectapi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Content Permissions</h1>
                        <h4 data-toc-skip class="author">Cole
Arendt</h4>
            
            <h4 data-toc-skip class="date">8/9/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/connectapi/blob/main/vignettes/articles/content_permissions.Rmd" class="external-link"><code>vignettes/articles/content_permissions.Rmd</code></a></small>
      <div class="d-none name"><code>content_permissions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>To filter content by permissions, you first need a “baseline set of
content.” This could be all content on the server, all content in a
particular tag, etc.</p>
<blockquote>
<p>NOTE: performance will depend heavily on the size of this baseline
set of content, because the permissions API today requires enumeration.
To improve performance for large sets of content, you can use
<code>pins</code> or caching on disk to reduce how often the requests
must be re-executed.</p>
</blockquote>
<p>We will start by deploying a few pieces of test content, two test
users, set access controls, and tags:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bundle_static.html">bundle_static</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"logo.png"</span>, package <span class="op">=</span> <span class="st">"connectapi"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">##   object 'type_sum.accel' not found</span></span></code></pre>
<pre><code><span><span class="co">## Bundling directory (/tmp/RtmpKPDnNH/bundledir2de01ff4affb)</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">content_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/deploy.html">deploy</a></span><span class="op">(</span><span class="va">client</span>, <span class="va">bnd</span>, title <span class="op">=</span> <span class="st">"App 1"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Getting content endpoint</span></span></code></pre>
<pre><code><span><span class="co">## Found EXISTING content 76f53880-139c-4482-82db-8553b43d0499 with name mwlefoodfieexombwkkeulbfd on http://localhost:32768</span></span></code></pre>
<pre><code><span><span class="co">## Uploading bundle</span></span></code></pre>
<pre><code><span><span class="co">## Deploying bundle</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">content_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/deploy.html">deploy</a></span><span class="op">(</span><span class="va">client</span>, <span class="va">bnd</span>, title <span class="op">=</span> <span class="st">"App 2"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Getting content endpoint</span></span></code></pre>
<pre><code><span><span class="co">## Found EXISTING content efcf86c8-4025-49c9-a8ef-e7766f447a13 with name pbcyvkgufivjubqtxvafbsnay on http://localhost:32768</span></span></code></pre>
<pre><code><span><span class="co">## Uploading bundle</span></span></code></pre>
<pre><code><span><span class="co">## Deploying bundle</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">user_restricted</span> <span class="op">&lt;-</span> <span class="va">client</span><span class="op">$</span><span class="fu">users_create</span><span class="op">(</span><span class="st">"example_restricted"</span>, <span class="st">"restricted@example.com"</span>, password <span class="op">=</span> <span class="fu"><a href="../reference/create_random_name.html">create_random_name</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">user_all</span> <span class="op">&lt;-</span> <span class="va">client</span><span class="op">$</span><span class="fu">users_create</span><span class="op">(</span><span class="st">"example_all"</span>, <span class="st">"all@example.com"</span>, password <span class="op">=</span> <span class="fu"><a href="../reference/create_random_name.html">create_random_name</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/tags.html">create_tag_tree</a></span><span class="op">(</span><span class="va">client</span>, <span class="st">"Example"</span>, <span class="st">"Permissions"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Posit Connect Tag Tree (filtered)</span></span>
<span><span class="co">## └── Example</span></span>
<span><span class="co">##    └── Permissions</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tags.html">get_tags</a></span><span class="op">(</span><span class="va">client</span><span class="op">)</span></span>
<span><span class="va">tag_1</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="va">Example</span><span class="op">$</span><span class="va">Permissions</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tags.html">set_content_tags</a></span><span class="op">(</span><span class="va">content_1</span>, <span class="va">tag_1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Posit Connect Tag Tree (content)</span></span>
<span><span class="co">## └── Example</span></span>
<span><span class="co">##    └── Permissions</span></span></code></pre>
<pre><code><span><span class="co">## Posit Connect Content Task: </span></span>
<span><span class="co">##   Content GUID: 76f53880-139c-4482-82db-8553b43d0499</span></span>
<span><span class="co">##   URL: http://localhost:32768/connect/#/apps/76f53880-139c-4482-82db-8553b43d0499/</span></span>
<span><span class="co">##   Task ID: ag5oNHtZFlac8dcB</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tags.html">set_content_tags</a></span><span class="op">(</span><span class="va">content_2</span>, <span class="va">tag_1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Posit Connect Tag Tree (content)</span></span>
<span><span class="co">## └── Example</span></span>
<span><span class="co">##    └── Permissions</span></span></code></pre>
<pre><code><span><span class="co">## Posit Connect Content Task: </span></span>
<span><span class="co">##   Content GUID: efcf86c8-4025-49c9-a8ef-e7766f447a13</span></span>
<span><span class="co">##   URL: http://localhost:32768/connect/#/apps/efcf86c8-4025-49c9-a8ef-e7766f447a13/</span></span>
<span><span class="co">##   Task ID: DxSMuazipbbBqnW4</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/permissions.html">content_add_user</a></span><span class="op">(</span><span class="va">content_1</span>, <span class="va">user_restricted</span><span class="op">$</span><span class="va">guid</span>, role <span class="op">=</span> <span class="st">"viewer"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Adding permission for user '862fd3b2-3257-42a2-adc0-4e539e145e66' with role 'viewer'</span></span></code></pre>
<pre><code><span><span class="co">## Posit Connect Content Task: </span></span>
<span><span class="co">##   Content GUID: 76f53880-139c-4482-82db-8553b43d0499</span></span>
<span><span class="co">##   URL: http://localhost:32768/connect/#/apps/76f53880-139c-4482-82db-8553b43d0499/</span></span>
<span><span class="co">##   Task ID: ag5oNHtZFlac8dcB</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/permissions.html">content_add_user</a></span><span class="op">(</span><span class="va">content_1</span>, <span class="va">user_all</span><span class="op">$</span><span class="va">guid</span>, <span class="st">"viewer"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Adding permission for user 'f052fe48-dacc-46ae-b383-de953c8e4e1a' with role 'viewer'</span></span></code></pre>
<pre><code><span><span class="co">## Posit Connect Content Task: </span></span>
<span><span class="co">##   Content GUID: 76f53880-139c-4482-82db-8553b43d0499</span></span>
<span><span class="co">##   URL: http://localhost:32768/connect/#/apps/76f53880-139c-4482-82db-8553b43d0499/</span></span>
<span><span class="co">##   Task ID: ag5oNHtZFlac8dcB</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/permissions.html">content_add_user</a></span><span class="op">(</span><span class="va">content_2</span>, <span class="va">user_all</span><span class="op">$</span><span class="va">guid</span>, <span class="st">"viewer"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Adding permission for user 'f052fe48-dacc-46ae-b383-de953c8e4e1a' with role 'viewer'</span></span></code></pre>
<pre><code><span><span class="co">## Posit Connect Content Task: </span></span>
<span><span class="co">##   Content GUID: efcf86c8-4025-49c9-a8ef-e7766f447a13</span></span>
<span><span class="co">##   URL: http://localhost:32768/connect/#/apps/efcf86c8-4025-49c9-a8ef-e7766f447a13/</span></span>
<span><span class="co">##   Task ID: DxSMuazipbbBqnW4</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="retrieve-the-content-list">Retrieve the Content List<a class="anchor" aria-label="anchor" href="#retrieve-the-content-list"></a>
</h2>
<p>The <code><a href="../reference/content_list_with_permissions.html">content_list_with_permissions()</a></code> function is the core
of what we want. However, it defaults to return <em>all content on the
server.</em> For some servers, this is very expensive (and can take 30
minutes or more).</p>
<p>Instead, we recommend using the <code>.p</code> argument to define a
“predicate” function (in the style of <code><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">purrr::keep()</a></code>) that
determines which records to keep. Since all this predicate has access to
is the “content list” itself, we will retrieve a list of Content GUIDs
first.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_tag_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/content_list.html">content_list_by_tag</a></span><span class="op">(</span><span class="va">client</span>, <span class="va">tag_1</span><span class="op">)</span></span>
<span><span class="va">content_guids</span> <span class="op">&lt;-</span> <span class="va">my_tag_content</span><span class="op">$</span><span class="va">guid</span></span>
<span></span>
<span><span class="va">c_with_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/content_list_with_permissions.html">content_list_with_permissions</a></span><span class="op">(</span><span class="va">client</span>, .p <span class="op">=</span> <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">guid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">content_guids</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Getting content list</span></span></code></pre>
<pre><code><span><span class="co">## Getting permission list</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># another approach, with a function</span></span>
<span><span class="va">c_with_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/content_list_with_permissions.html">content_list_with_permissions</a></span><span class="op">(</span><span class="va">client</span>, .p <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">.x</span><span class="op">$</span><span class="va">guid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">content_guids</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Getting content list</span></span>
<span><span class="co">## Getting permission list</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># notice the "permission" column:</span></span>
<span><span class="va">c_with_p</span><span class="op">$</span><span class="va">permission</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">##   id    content_guid                         principal_guid principal_type role </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 3     efcf86c8-4025-49c9-a8ef-e7766f447a13 f052fe48-dacc… user           view…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> <span style="color: #BB0000;">NA</span>    efcf86c8-4025-49c9-a8ef-e7766f447a13 0ddc15fe-5701… user           owner</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   id    content_guid                         principal_guid principal_type role </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 1     76f53880-139c-4482-82db-8553b43d0499 862fd3b2-3257… user           view…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 2     76f53880-139c-4482-82db-8553b43d0499 f052fe48-dacc… user           view…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>    76f53880-139c-4482-82db-8553b43d0499 0ddc15fe-5701… user           owner</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="filter-the-content-list">Filter the Content List<a class="anchor" aria-label="anchor" href="#filter-the-content-list"></a>
</h2>
<p>We added a helper function to the package that should filter the
content list for you: <code><a href="../reference/content_list_with_permissions.html">content_list_guid_has_access()</a></code></p>
<p>In a Shiny application or other personalized context (i.e. using
<code>session$user</code>), you then filter the content list to only
what a user should see (using the <code>permissions</code> column
returned above)</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># restricted has access</span></span>
<span><span class="fu"><a href="../reference/content_list_with_permissions.html">content_list_guid_has_access</a></span><span class="op">(</span><span class="va">c_with_p</span>, <span class="va">user_restricted</span><span class="op">$</span><span class="va">guid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">title</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "mwlefoodfieexombwkkeulbfd"</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># "all" has access</span></span>
<span><span class="fu"><a href="../reference/content_list_with_permissions.html">content_list_guid_has_access</a></span><span class="op">(</span><span class="va">c_with_p</span>, <span class="va">user_all</span><span class="op">$</span><span class="va">guid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">title</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "pbcyvkgufivjubqtxvafbsnay" "mwlefoodfieexombwkkeulbfd"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="display-the-content-list">Display the Content List<a class="anchor" aria-label="anchor" href="#display-the-content-list"></a>
</h2>
<p>We plan to build a full example in Shiny (and to show example code
below). However, suffice it to say that for RStudio Connect version
1.9.0 or newer, <a href="https://pkgs.rstudio.com/connectwidgets/" class="external-link"><code>connectwidgets</code></a>
is a great way to plan to display your data, and provides several
helpers for doing so!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Toph Allen, Neal Richardson, Sean Lopp, Cole Arendt, Posit, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
